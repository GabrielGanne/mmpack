#!/bin/sh

set -e
set -x

testdir=$(pwd)/venv
python_minor=$(python3 -c 'import sys; print(sys.version_info.minor)')
python_testdir="$testdir/lib/python3.${python_minor}"

mkdir -p venv
make install prefix=$testdir
export PYTHONPATH="$python_testdir:$python_testdir/site-packages:$PYTHONPATH"

cd $srcdir

python3 tests/pytests.py
