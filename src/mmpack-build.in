#!/bin/sh
#
# @mindmaze_header@

PYTHON=${PYTHON:-python3}

cmd=$1
mmpack_moduledir=<pythondir>/mmpack
if [ -n "$VIRTUAL_ENV" ] ; then
	mmpack_moduledir="lib/python${mmpack_moduledir#*/lib/python}"
	mmpack_moduledir="$VIRTUAL_ENV/$mmpack_moduledir"
fi

# Get python entry file by transforming the '-' of command into '_'
pyfile=$mmpack_moduledir/mmpack_`echo $cmd | tr '-' '_'`.py


list_commands() {
	for file in `ls $mmpack_moduledir/mmpack_*.py`; do
		cmd=`basename $file .py | cut -f2- -d'_' | tr '_' '-'`
		printf "$cmd\n"
	done
}

print_usage() {
	cat << ENDOFDOC
This is a stub for all mmpack commands

Usage:
mmpack <command> [command-options]

Show full mmpack help
mmpack --help

List all mmpack commands:
mmpack --list-commands

More infos about a specific command:
mmpack <command> --help

TODO:
- user commands to implement
  * config
  * download
  * info/show
  * install
  * reinstall
  * search
  * uninstall
  * update/make-cache
  * upgrade

- package creation commands to implement:
  * pkg-check
  * pkg-create
  * pkg-show

- package DB commands to implement:
  * provides
  * ...

List of available commands:
ENDOFDOC
	for cmd in $(list_commands) ; do
		printf "\t$cmd\n"
	done
}
for arg in "$@" ; do
case $arg in
	--list-commands) list_commands ; exit 0 ;;
	-h|--help) print_usage ; exit 0 ;;
esac
done




# check command is provided
if [ -z "$cmd" ]; then
	echo "missing command"
	print_usage
	exit 1
fi

# check target file is readable
if ! [ -r $pyfile ]; then
	echo "command $cmd unknown"
	print_usage
	exit 1
fi

shift 1
exec $PYTHON $pyfile "$@"
