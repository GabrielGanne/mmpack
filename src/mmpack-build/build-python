# vi:syntax=sh

set -e

sitedir=$PREFIX/lib/python3/site-packages

# Install python package
#
# python distutils options:
# --no-user-cfg : ignore pydistutils.cfg in your home directory
# install : install everything from build directory (build if not done yet). install command options:
#       --root : install everything relative to this alternate root directory
#       --prefix : installation prefix
#       --no-compile: don't compile .py files
#       --install-lib: installation directory for all module distributions
python3 setup.py --no-user-cfg install --root $DESTDIR --prefix $PREFIX --no-compile --install-lib $sitedir

# Run test on installed package (in build dir)
if [ "$SKIP_TESTS" != "True" ] ; then
	ld_lib_path=$PREFIX/lib${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
	PYTHONPATH=$DESTDIR$sitedir LD_LIBRARY_PATH=$ld_lib_path python3 $SRCDIR/setup.py --no-user-cfg check
fi
